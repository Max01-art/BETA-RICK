<!DOCTYPE html>
<html lang="lv" class="theme-light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ meta_description|default('Classmate - Organizƒì savus mƒÅcƒ´bu darbus') }}">
    <meta name="keywords" content="kontroldarbi, mƒÅjasdarbi, skola, organizƒÅcija">
    <title>{% block title %}{{ app_name }}{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='images/logo.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/logo.png') }}">
    
    <!-- Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
    
    {% block extra_css %}{% endblock %}
    
    <style>
        /* Layout specific styles */
        .main-layout {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .content-wrapper {
            flex: 1;
            padding-top: 80px; /* Navbar height */
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem 0;
        }
        
        .page-header h1 {
            margin: 0;
            font-size: 2rem;
        }
        
        /* Flash messages */
        .flash-messages {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 9998;
            max-width: 400px;
        }
        
        .flash-message {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            animation: slideInRight 0.3s ease;
            border-left: 4px solid;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .flash-success {
            border-color: var(--success-color);
        }
        
        .flash-danger {
            border-color: var(--danger-color);
        }
        
        .flash-warning {
            border-color: var(--warning-color);
        }
        
        .flash-info {
            border-color: var(--info-color);
        }
    </style>
</head>
<body class="main-layout">
    <!-- Theme Decorations -->
    <div class="theme-decorations">
        <div class="sun"></div>
        <div class="moon"></div>
        <div class="stars" id="stars"></div>
        <div class="real-cloud real-cloud-1"></div>
        <div class="real-cloud real-cloud-2"></div>
        <div class="real-cloud real-cloud-3"></div>
    </div>

    <!-- Navbar -->
    {% include 'components/navbar.html' %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                <div class="flash-message flash-{{ category }}" onclick="this.remove()">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main class="content-wrapper">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% include 'components/footer.html' %}

    <!-- Timer Modal (if not host) -->
    {% if not is_host %}
        {% include 'components/timer.html' %}
    {% endif %}

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    
    {% if not is_host %}
    <script src="{{ url_for('static', filename='js/timer.js') }}"></script>
    {% endif %}
    
    {% block extra_js %}{% endblock %}
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Classmate v{{ app_version }} –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º—ã
            loadTheme();
            
            {% if not is_host %}
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞
            if (typeof initTimer === 'function') {
                initTimer();
            }
            {% endif %}
            
            // SocketIO –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
            const socket = io();
            
            socket.on('connect', function() {
                console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É');
            });
            
            socket.on('disconnect', function() {
                console.log('‚ùå –û—Ç–∫–ª—é—á–µ–Ω –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
            });
            
            socket.on('online_count_update', function(data) {
                const countElement = document.getElementById('onlineCount');
                if (countElement) {
                    countElement.textContent = data.count;
                }
            });
            
            socket.on('new_notification', function(data) {
                showNotification(data);
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ flash —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                const flashMessages = document.querySelectorAll('.flash-message');
                flashMessages.forEach(msg => {
                    msg.style.opacity = '0';
                    setTimeout(() => msg.remove(), 300);
                });
            }, 5000);
        });
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(data) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±—Ä–∞—É–∑–µ—Ä–æ–º
            if (!("Notification" in window)) {
                return;
            }
            
            // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
            if (Notification.permission === "granted") {
                new Notification(data.title, {
                    body: data.body,
                    icon: '/static/images/logo.png'
                });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(function(permission) {
                    if (permission === "granted") {
                        new Notification(data.title, {
                            body: data.body,
                            icon: '/static/images/logo.png'
                        });
                    }
                });
            }
        }
    </script>
</body>
</html>